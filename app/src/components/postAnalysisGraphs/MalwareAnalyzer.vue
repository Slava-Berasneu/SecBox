<template>
  <div>
    <div class="table-container">
      <h2>Malware Analyzer</h2>
      <table class="custom-table">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Syscall Prediction</th>
            <th>Performance Prediction</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(entry, index) in mergedData" :key="index">
            <td>{{ entry.timestamp }}</td>
            <td :class="getSyscallPredictionClass(entry.syscallPrediction)">{{ entry.syscallPrediction }}</td>
            <td></td>
            <!--:class="getPerformancePredictionClass(entry.performancePrediction)">{{ entry.performancePrediction }}"-->
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</template>

<script>
import { io } from 'socket.io-client';



export default {
  data() {
    return {
      syscallData: [],
      performanceData: [],
      mergedData: []
    };
  },
  created() {
    this.socket = io("ws://"+process.env.VUE_APP_ROOT+"/live");

    this.socket.on('syscall_data', data => {
      this.syscallData.push(JSON.parse(data))
      this.mergeData();
    });

    this.socket.on('performance_data', data => {
      console.log("received performance data ",data)
      this.performanceData = data
      this.mergeData();
    });

  },
  methods: {
    mergeData() {
      // Merge the data based on timestamps
      console.log("syscallData", JSON.parse(JSON.stringify(this.syscallData)))
      this.mergedData = JSON.parse(JSON.stringify(this.syscallData)).map(syscallEntry => {
        const matchingPerformanceEntry = this.performanceData.find(performanceEntry => performanceEntry[0] === syscallEntry[0]);
        console.log("Entry", syscallEntry[0], " ", syscallEntry[1])
        return {
          timestamp: syscallEntry[0],
          syscallPrediction: syscallEntry[1],
          performancePrediction: matchingPerformanceEntry ? matchingPerformanceEntry[1] : ''
        };
      });
    },
    getSyscallPredictionClass(prediction) {
      return {
        'infected-cell': prediction === 'infected',
        'healthy-cell': prediction === 'healthy'
      };
    },
    //getPerformancePredictionClass(prediction) {
      //
    //}
  }
};
</script>

<style>
.table-container {
  height: 300px;
  overflow-y: scroll;
  background-color: black;
  border: 1px solid #ccc;
  padding: 10px;
}

.custom-table {
  width: 100%;
  border-collapse: collapse;
}

.custom-table th,
.custom-table td {
  border: 1px solid white;
  padding: 8px;
  color: white;
}

.custom-table th {
  background-color: #333;
}

.custom-table tbody tr:nth-child(even) {
  background-color: #444;
}

.custom-table tbody tr:hover {
  background-color: #555;
}

.infected-cell {
  color: red;
}

.healthy-cell {
  color: green;
}
</style>